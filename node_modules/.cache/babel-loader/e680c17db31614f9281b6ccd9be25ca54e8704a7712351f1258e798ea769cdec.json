{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst react_1 = require(\"react\");\nconst types_1 = require(\"../types\");\nconst storageKey = 'affinidi-login';\nconst getStorgageData = () => {\n  const data = window.localStorage.getItem(storageKey);\n  return data ? JSON.parse(data) : undefined;\n};\nconst setStorgageData = data => {\n  window.localStorage.setItem(storageKey, JSON.stringify(data));\n  return data;\n};\nconst clearStorgageData = () => {\n  window.localStorage.removeItem(storageKey);\n};\nconst useAffinidiProfile = function () {\n  let {\n    redirectTo = '/',\n    authCompleteUrl = '/api/affinidi-auth/complete'\n  } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const [isLoading, setIsLoading] = (0, react_1.useState)(false);\n  const [code, setCode] = (0, react_1.useState)(undefined);\n  const [state, setState] = (0, react_1.useState)(null);\n  (0, react_1.useEffect)(() => {\n    const urlObject = new URL(window.location.href);\n    const params = new URLSearchParams(urlObject.search);\n    const pCode = params.get('code');\n    const perror = params.get('error');\n    if (pCode) {\n      setCode(pCode);\n      setState(params.get('state'));\n    } else if (perror) {\n      const errorDescription = params.get('error_description') || '';\n      setStorgageData({\n        error: \"\".concat(types_1.errorMessageMap[perror] || 'Unexpected error', \" - \").concat(errorDescription && types_1.errorDescriptionMessageMap[errorDescription] || undefined)\n      });\n      window.location.href = redirectTo;\n    }\n  }, []);\n  (0, react_1.useEffect)(() => {\n    if (!code) {\n      return;\n    }\n    const getProfile = async params => {\n      setIsLoading(true);\n      const res = await fetch(authCompleteUrl, {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(params)\n      });\n      const response = await res.json();\n      if (response.error) {\n        setStorgageData({\n          error: \"\".concat(response.error, \"-\").concat(response.error_description)\n        });\n      } else {\n        setStorgageData({\n          profile: response.user\n        });\n      }\n      setIsLoading(false);\n      window.location.href = redirectTo;\n    };\n    const params = {\n      code,\n      state\n    };\n    getProfile(params);\n  }, [code, state]);\n  async function handleLogout() {\n    clearStorgageData();\n  }\n  return {\n    handleLogout,\n    isLoading,\n    ...getStorgageData()\n  };\n};\nexports.default = useAffinidiProfile;","map":{"version":3,"names":["react_1","require","types_1","storageKey","getStorgageData","data","window","localStorage","getItem","JSON","parse","undefined","setStorgageData","setItem","stringify","clearStorgageData","removeItem","useAffinidiProfile","redirectTo","authCompleteUrl","arguments","length","isLoading","setIsLoading","useState","code","setCode","state","setState","useEffect","urlObject","URL","location","href","params","URLSearchParams","search","pCode","get","perror","errorDescription","error","concat","errorMessageMap","errorDescriptionMessageMap","getProfile","res","fetch","method","headers","body","response","json","error_description","profile","user","handleLogout","exports","default"],"sources":["../../src/hooks/useAffinidiProfile.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}