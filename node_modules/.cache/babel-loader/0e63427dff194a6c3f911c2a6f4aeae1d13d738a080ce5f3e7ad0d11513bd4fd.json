{"ast":null,"code":"import React,{useContext,useEffect,useState}from'react';import{Link}from'react-router-dom';import UserContext from'../contexts/UserContext';import{AffinidiLoginButton,useAffinidiProfile}from'@affinidi/affinidi-react-auth';import'./Header.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Header=()=>{const{setProfile}=useContext(UserContext);const{isLoading,error,profile,handleLogout}=useAffinidiProfile({authCompleteUrl:'/api/affinidi-auth/complete'});const[localProfile,setLocalProfile]=useState(null);useEffect(()=>{// Convert objects to strings to compare them\nconst currentProfileStr=JSON.stringify(profile);const localProfileStr=JSON.stringify(localProfile);// Only update if the stringified versions differ\nif(currentProfileStr!==localProfileStr){setLocalProfile(profile);setProfile(profile);// assuming setProfile comes from a context and is stable\n}},[profile,localProfile,setProfile]);const logout=()=>{handleLogout();window.location.href=\"/\";};const renderLoginState=()=>{if(isLoading){return/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"});}if(error){handleLogout();return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{children:\"Unable to load user data. Please try again later.\"})});}if(profile){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Welcome, \",profile.givenName]}),/*#__PURE__*/_jsx(\"button\",{onClick:logout,children:\"Logout\"})]});}return/*#__PURE__*/_jsx(AffinidiLoginButton,{});};return/*#__PURE__*/_jsxs(\"header\",{className:\"Header\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"StackShop\"})}),/*#__PURE__*/_jsxs(\"nav\",{children:[renderLoginState(),/*#__PURE__*/_jsx(Link,{to:\"/cart\",className:\"CartIcon\",children:/*#__PURE__*/_jsx(\"img\",{src:\"/cart.png\",alt:\"Cart\"})})]})]});};export default Header;","map":{"version":3,"names":["React","useContext","useEffect","useState","Link","UserContext","AffinidiLoginButton","useAffinidiProfile","jsx","_jsx","jsxs","_jsxs","Header","setProfile","isLoading","error","profile","handleLogout","authCompleteUrl","localProfile","setLocalProfile","currentProfileStr","JSON","stringify","localProfileStr","logout","window","location","href","renderLoginState","children","givenName","onClick","className","to","src","alt"],"sources":["/home/the-backend-dev/Desktop/affinidi/affinidi-capstone/src/components/Header.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport UserContext from '../contexts/UserContext';\nimport { AffinidiLoginButton, useAffinidiProfile } from '@affinidi/affinidi-react-auth';\nimport './Header.css';\n\nconst Header = () => \n{\n\n  const { setProfile } = useContext(UserContext);\n  const { isLoading, error, profile, handleLogout } = useAffinidiProfile({\n    authCompleteUrl: '/api/affinidi-auth/complete'\n  });\n\n  const [localProfile, setLocalProfile] = useState(null);\n\n    useEffect(() => {\n    // Convert objects to strings to compare them\n    const currentProfileStr = JSON.stringify(profile);\n    const localProfileStr = JSON.stringify(localProfile);\n\n    // Only update if the stringified versions differ\n    if (currentProfileStr !== localProfileStr) {\n        setLocalProfile(profile);\n        setProfile(profile); // assuming setProfile comes from a context and is stable\n    }\n    }, [profile,localProfile,setProfile])\n\n  const logout = () => {\n    handleLogout();\n    window.location.href = \"/\";\n  };\n\n  const renderLoginState = () => {\n    if (isLoading) {\n      return <p>Loading...</p>;\n    }\n\n    if (error) {\n      handleLogout();\n      return (\n        <div>\n          <p>Unable to load user data. Please try again later.</p>\n        </div>\n      );\n    }\n    if (profile) {\n        return (\n          <div>\n            <span>Welcome, {profile.givenName}</span>\n            <button onClick={logout}>Logout</button>\n          </div>\n        );\n      }\n  \n  return <AffinidiLoginButton />;\n    };\n  \n    return (\n      <header className=\"Header\">\n        <Link to=\"/\">\n          <h1>StackShop</h1>\n        </Link>\n        <nav>\n          {renderLoginState()}\n          <Link to=\"/cart\" className=\"CartIcon\">\n            <img src=\"/cart.png\" alt=\"Cart\"/>\n          </Link>\n        </nav>\n      </header>\n    );\n  };\n  \n  export default Header;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,UAAU,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC9D,OAASC,IAAI,KAAQ,kBAAkB,CACvC,MAAO,CAAAC,WAAW,KAAM,yBAAyB,CACjD,OAASC,mBAAmB,CAAEC,kBAAkB,KAAQ,+BAA+B,CACvF,MAAO,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEtB,KAAM,CAAAC,MAAM,CAAGA,CAAA,GACf,CAEE,KAAM,CAAEC,UAAW,CAAC,CAAGZ,UAAU,CAACI,WAAW,CAAC,CAC9C,KAAM,CAAES,SAAS,CAAEC,KAAK,CAAEC,OAAO,CAAEC,YAAa,CAAC,CAAGV,kBAAkB,CAAC,CACrEW,eAAe,CAAE,6BACnB,CAAC,CAAC,CAEF,KAAM,CAACC,YAAY,CAAEC,eAAe,CAAC,CAAGjB,QAAQ,CAAC,IAAI,CAAC,CAEpDD,SAAS,CAAC,IAAM,CAChB;AACA,KAAM,CAAAmB,iBAAiB,CAAGC,IAAI,CAACC,SAAS,CAACP,OAAO,CAAC,CACjD,KAAM,CAAAQ,eAAe,CAAGF,IAAI,CAACC,SAAS,CAACJ,YAAY,CAAC,CAEpD;AACA,GAAIE,iBAAiB,GAAKG,eAAe,CAAE,CACvCJ,eAAe,CAACJ,OAAO,CAAC,CACxBH,UAAU,CAACG,OAAO,CAAC,CAAE;AACzB,CACA,CAAC,CAAE,CAACA,OAAO,CAACG,YAAY,CAACN,UAAU,CAAC,CAAC,CAEvC,KAAM,CAAAY,MAAM,CAAGA,CAAA,GAAM,CACnBR,YAAY,CAAC,CAAC,CACdS,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,GAAG,CAC5B,CAAC,CAED,KAAM,CAAAC,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,GAAIf,SAAS,CAAE,CACb,mBAAOL,IAAA,MAAAqB,QAAA,CAAG,YAAU,CAAG,CAAC,CAC1B,CAEA,GAAIf,KAAK,CAAE,CACTE,YAAY,CAAC,CAAC,CACd,mBACER,IAAA,QAAAqB,QAAA,cACErB,IAAA,MAAAqB,QAAA,CAAG,mDAAiD,CAAG,CAAC,CACrD,CAAC,CAEV,CACA,GAAId,OAAO,CAAE,CACT,mBACEL,KAAA,QAAAmB,QAAA,eACEnB,KAAA,SAAAmB,QAAA,EAAM,WAAS,CAACd,OAAO,CAACe,SAAS,EAAO,CAAC,cACzCtB,IAAA,WAAQuB,OAAO,CAAEP,MAAO,CAAAK,QAAA,CAAC,QAAM,CAAQ,CAAC,EACrC,CAAC,CAEV,CAEJ,mBAAOrB,IAAA,CAACH,mBAAmB,GAAE,CAAC,CAC5B,CAAC,CAED,mBACEK,KAAA,WAAQsB,SAAS,CAAC,QAAQ,CAAAH,QAAA,eACxBrB,IAAA,CAACL,IAAI,EAAC8B,EAAE,CAAC,GAAG,CAAAJ,QAAA,cACVrB,IAAA,OAAAqB,QAAA,CAAI,WAAS,CAAI,CAAC,CACd,CAAC,cACPnB,KAAA,QAAAmB,QAAA,EACGD,gBAAgB,CAAC,CAAC,cACnBpB,IAAA,CAACL,IAAI,EAAC8B,EAAE,CAAC,OAAO,CAACD,SAAS,CAAC,UAAU,CAAAH,QAAA,cACnCrB,IAAA,QAAK0B,GAAG,CAAC,WAAW,CAACC,GAAG,CAAC,MAAM,CAAC,CAAC,CAC7B,CAAC,EACJ,CAAC,EACA,CAAC,CAEb,CAAC,CAED,cAAe,CAAAxB,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}